

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Analysis Bayesian Approach &mdash; abexp 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analysis Bootstrap" href="AnalysisBootstrap.html" />
    <link rel="prev" title="Analysis Frequentist Approach" href="AnalysisFrequentistApproach.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> abexp
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../abexp.html">ABexp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="SampleSizeDetermination.html">Sample Size Determination</a></li>
<li class="toctree-l2"><a class="reference internal" href="Allocation.html">Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="AnalysisFrequentistApproach.html">Analysis Frequentist Approach</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Analysis Bayesian Approach</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Compare-means">Compare means</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Compare-proportions">Compare proportions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Bayesian-GLM">Bayesian GLM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AnalysisBootstrap.html">Analysis Bootstrap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">abexp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Analysis Bayesian Approach</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/AnalysisBayesianApproach.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Analysis-Bayesian-Approach">
<h1>Analysis Bayesian Approach<a class="headerlink" href="#Analysis-Bayesian-Approach" title="Permalink to this headline">¶</a></h1>
<p>This tutorial shows how to perform post-test analysis of an A/B test experiment with two variants, so called control and treatment groups, using bayesian statistics. It handles both the case of means comparison and conversions comparison.</p>
<p>Let’s import first the tools needed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">abexp.core.analysis_bayesian</span> <span class="kn">import</span> <span class="n">BayesianAnalyzer</span>
<span class="kn">from</span> <span class="nn">abexp.core.analysis_bayesian</span> <span class="kn">import</span> <span class="n">BayesianGLMAnalyzer</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Compare-means">
<h2>Compare means<a class="headerlink" href="#Compare-means" title="Permalink to this headline">¶</a></h2>
<p>Here we want to compare the <em>average revenue per user</em> of the control group versus the treatment group.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Revenue for users</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">revenue_contr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">revenue_treat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define the analyzer</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">BayesianAnalyzer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prob</span><span class="p">,</span> <span class="n">lift</span><span class="p">,</span> <span class="n">diff_means</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compare_mean</span><span class="p">(</span><span class="n">obs_contr</span><span class="o">=</span><span class="n">revenue_contr</span><span class="p">,</span> <span class="n">obs_treat</span><span class="o">=</span><span class="n">revenue_treat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
logp = -1.18e+05, ||grad|| = 3.0081e+10: 100%|██████████| 22/22 [00:00&lt;00:00, 773.97it/s]
Multiprocess sampling (4 chains in 4 jobs)
CompoundStep
&gt;Metropolis: [nu_minus_one]
&gt;Metropolis: [std_treat]
&gt;Metropolis: [std_contr]
&gt;Metropolis: [mean_treat]
&gt;Metropolis: [mean_contr]
Sampling 4 chains, 0 divergences: 100%|██████████| 202000/202000 [02:51&lt;00:00, 1181.01draws/s]
The rhat statistic is larger than 1.4 for some parameters. The sampler did not converge.
The estimated number of effective samples is smaller than 200 for some parameters.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability that mean revenue(treatment) is greater than mean revenue(control) = </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prob</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Probability that mean revenue(treatment) is greater than mean revenue(control) = 94.79%
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lift between treatment and control = </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lift</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lift between treatment and control = 33.20%
</pre></div></div>
</div>
<p>The result of bayesian A/B testing is the probability that the treatment group perform better than the control group i.e. highest mean revenue per user value in the current example. This is a very intuitive way of doing A/B testing because it does not introduce any statistical measures (e.g. p-value) which are more difficult to be interpreted by non statisticians.</p>
<p>We can set an arbitrary threshold to define how to consider the outcome of the bayesian test, e.g. if <code class="docutils literal notranslate"><span class="pre">prob</span></code> <span class="math notranslate nohighlight">\(&gt;\)</span> <code class="docutils literal notranslate"><span class="pre">90%</span></code> we can conclude to a significative effect of the treatment on the mean revenue per user when compare to the control group.</p>
</div>
<div class="section" id="Compare-proportions">
<h2>Compare proportions<a class="headerlink" href="#Compare-proportions" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of users that made a purchase</span>
<span class="n">purchase_contr</span> <span class="o">=</span> <span class="mi">470</span>
<span class="n">purchase_treat</span> <span class="o">=</span> <span class="mi">500</span>


<span class="c1"># Total number of users</span>
<span class="n">total_usr_treat</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">total_usr_contr</span> <span class="o">=</span> <span class="mi">5000</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prob</span><span class="p">,</span> <span class="n">lift</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compare_conv</span><span class="p">(</span><span class="n">conv_contr</span><span class="o">=</span><span class="n">purchase_contr</span><span class="p">,</span>
                                   <span class="n">conv_treat</span><span class="o">=</span><span class="n">purchase_treat</span><span class="p">,</span>
                                   <span class="n">nobs_contr</span><span class="o">=</span><span class="n">total_usr_treat</span><span class="p">,</span>
                                   <span class="n">nobs_treat</span><span class="o">=</span><span class="n">total_usr_contr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability that mean revenue(treatment) is greater than mean revenue(control) = </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prob</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Probability that mean revenue(treatment) is greater than mean revenue(control) = 84.45%
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lift between treatment and control = </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lift</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lift between treatment and control = 6.37%
</pre></div></div>
</div>
</div>
<div class="section" id="Bayesian-GLM">
<h2>Bayesian GLM<a class="headerlink" href="#Bayesian-GLM" title="Permalink to this headline">¶</a></h2>
<p>Here we want to compare the <em>average revenue per user</em> of the control group versus the treatment group. We are also interested to differentiate the results based on some categorical features of the input samples (i.e.  <code class="docutils literal notranslate"><span class="pre">seniority_level</span></code>, <code class="docutils literal notranslate"><span class="pre">country</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define the analyzer</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">BayesianGLMAnalyzer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>Multivariate Regression</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;seniority_level&#39;</span><span class="p">,</span> <span class="s1">&#39;revenue&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">multivariate_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;revenue&#39;</span><span class="p">)</span>
<span class="n">stats</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [lam, seniority_level, group, Intercept]
Sampling 4 chains, 0 divergences: 100%|██████████| 8000/8000 [00:03&lt;00:00, 2035.12draws/s]
The number of effective samples is smaller than 25% for some parameters.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>Prob&lt;0</th>
      <th>Prob&gt;0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>1.048460</td>
      <td>2.940644</td>
      <td>-13.254892</td>
      <td>-0.372376</td>
      <td>0.967242</td>
      <td>2.372862</td>
      <td>26.860366</td>
      <td>0.30325</td>
      <td>0.69675</td>
    </tr>
    <tr>
      <th>group</th>
      <td>0.576785</td>
      <td>0.551946</td>
      <td>-1.425842</td>
      <td>0.195678</td>
      <td>0.572784</td>
      <td>0.957911</td>
      <td>2.738990</td>
      <td>0.14725</td>
      <td>0.85275</td>
    </tr>
    <tr>
      <th>seniority_level</th>
      <td>1.646575</td>
      <td>1.287070</td>
      <td>-2.438778</td>
      <td>0.817672</td>
      <td>1.352801</td>
      <td>2.257462</td>
      <td>8.219804</td>
      <td>0.05050</td>
      <td>0.94950</td>
    </tr>
    <tr>
      <th>lam</th>
      <td>0.774718</td>
      <td>1.390844</td>
      <td>0.001202</td>
      <td>0.101534</td>
      <td>0.296813</td>
      <td>0.821106</td>
      <td>16.358989</td>
      <td>0.00000</td>
      <td>1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>In the last column <code class="docutils literal notranslate"><span class="pre">Prob&gt;0</span></code>, the table above shows that there is there is <code class="docutils literal notranslate"><span class="pre">85.27%</span></code> of probability that <code class="docutils literal notranslate"><span class="pre">revenue</span></code> of <em>group 1</em> is greater than <em>group 2</em>. Moreover it also shows that there is<code class="docutils literal notranslate"><span class="pre">94.95%</span></code> of probability that <code class="docutils literal notranslate"><span class="pre">seniority</span> <span class="pre">level</span></code> is positively associated to <code class="docutils literal notranslate"><span class="pre">revenue</span></code>.</p>
<p>For the sake of providing a general summary of statistics the table also shows: the intercept and lambda (<code class="docutils literal notranslate"><span class="pre">lam</span></code>) of the regression model.</p>
<p><strong>Hierarchical regression</strong></p>
<p>If your are not familiar with hierarchical regression have a look at the blog <a class="reference external" href="https://twiecki.io/blog/2014/03/17/bayesian-glms-3/">https://twiecki.io/blog/2014/03/17/bayesian-glms-3/</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>   <span class="s1">&#39;USA&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>   <span class="s1">&#39;USA&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Italy&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;France&#39;</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;revenue&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">hierarchical_regression</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">group_col</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">cat_col</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">kpi_col</span><span class="o">=</span><span class="s1">&#39;revenue&#39;</span><span class="p">)</span>
<span class="n">stats</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [eps, beta, alpha, sigma_beta, sigma_alpha, mu_beta, mu_alpha]
Sampling 4 chains, 816 divergences: 100%|██████████| 6000/6000 [02:10&lt;00:00, 45.87draws/s]
There were 52 divergences after tuning. Increase `target_accept` or reparameterize.
There were 364 divergences after tuning. Increase `target_accept` or reparameterize.
The acceptance probability does not match the target. It is 0.2979906043312202, but should be close to 0.8. Try to increase the number of tuning steps.
There were 75 divergences after tuning. Increase `target_accept` or reparameterize.
The acceptance probability does not match the target. It is 0.6628490775514363, but should be close to 0.8. Try to increase the number of tuning steps.
There were 325 divergences after tuning. Increase `target_accept` or reparameterize.
The acceptance probability does not match the target. It is 0.7113696800957767, but should be close to 0.8. Try to increase the number of tuning steps.
The chain reached the maximum tree depth. Increase max_treedepth, increase target_accept or reparameterize.
The rhat statistic is larger than 1.4 for some parameters. The sampler did not converge.
The estimated number of effective samples is smaller than 200 for some parameters.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>Prob&lt;0</th>
      <th>Prob&gt;0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mu_alpha</th>
      <td>-0.028085</td>
      <td>0.989639</td>
      <td>-3.581447</td>
      <td>-0.695825</td>
      <td>-0.132219</td>
      <td>0.688185</td>
      <td>3.598191</td>
      <td>0.54100</td>
      <td>0.45900</td>
    </tr>
    <tr>
      <th>mu_beta</th>
      <td>0.176766</td>
      <td>0.993789</td>
      <td>-3.468508</td>
      <td>-0.487023</td>
      <td>0.309218</td>
      <td>0.832437</td>
      <td>3.588725</td>
      <td>0.39750</td>
      <td>0.60250</td>
    </tr>
    <tr>
      <th>alpha__USA</th>
      <td>14.074894</td>
      <td>37.636252</td>
      <td>-171.899366</td>
      <td>-0.990796</td>
      <td>0.317332</td>
      <td>11.625923</td>
      <td>240.521179</td>
      <td>0.45875</td>
      <td>0.54125</td>
    </tr>
    <tr>
      <th>alpha__Italy</th>
      <td>32.564691</td>
      <td>46.492324</td>
      <td>-57.351711</td>
      <td>-0.532305</td>
      <td>0.945736</td>
      <td>99.803488</td>
      <td>163.613053</td>
      <td>0.39150</td>
      <td>0.60850</td>
    </tr>
    <tr>
      <th>alpha__France</th>
      <td>2.547504</td>
      <td>6.700164</td>
      <td>-40.234538</td>
      <td>-0.467854</td>
      <td>1.040751</td>
      <td>4.971800</td>
      <td>91.083058</td>
      <td>0.35550</td>
      <td>0.64450</td>
    </tr>
    <tr>
      <th>beta__USA</th>
      <td>22.419341</td>
      <td>43.726614</td>
      <td>-140.604607</td>
      <td>-0.145441</td>
      <td>1.603786</td>
      <td>33.143822</td>
      <td>272.022584</td>
      <td>0.26150</td>
      <td>0.73850</td>
    </tr>
    <tr>
      <th>beta__Italy</th>
      <td>-1.967748</td>
      <td>58.002111</td>
      <td>-484.885230</td>
      <td>-3.517865</td>
      <td>0.349032</td>
      <td>3.400547</td>
      <td>481.391653</td>
      <td>0.44850</td>
      <td>0.55150</td>
    </tr>
    <tr>
      <th>beta__France</th>
      <td>34.939470</td>
      <td>45.972820</td>
      <td>-86.950038</td>
      <td>-0.048646</td>
      <td>1.928143</td>
      <td>94.856067</td>
      <td>208.532713</td>
      <td>0.25650</td>
      <td>0.74350</td>
    </tr>
    <tr>
      <th>sigma_alpha</th>
      <td>26.197334</td>
      <td>42.125100</td>
      <td>0.190135</td>
      <td>0.528937</td>
      <td>1.937846</td>
      <td>51.083900</td>
      <td>458.640177</td>
      <td>0.00000</td>
      <td>1.00000</td>
    </tr>
    <tr>
      <th>sigma_beta</th>
      <td>36.309637</td>
      <td>54.466205</td>
      <td>0.075608</td>
      <td>0.989605</td>
      <td>5.203234</td>
      <td>59.455603</td>
      <td>434.367847</td>
      <td>0.00000</td>
      <td>1.00000</td>
    </tr>
    <tr>
      <th>eps</th>
      <td>60.218967</td>
      <td>46.760094</td>
      <td>0.103970</td>
      <td>0.664053</td>
      <td>67.356771</td>
      <td>99.604387</td>
      <td>282.430219</td>
      <td>0.00000</td>
      <td>1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>In the table above we will focus on the <em>beta</em> parameters which represents the coefficients of the hierarchical regression. In the last column <code class="docutils literal notranslate"><span class="pre">Prob&gt;0</span></code>, the table shows per each country the probability that <code class="docutils literal notranslate"><span class="pre">revenue</span></code> of <em>group 1</em> is greater than <em>group 2</em>. In this way we can have an idea of the country in which the treatment was more effective.</p>
<p>For the sake of providing a general summary of statistics the table also shows: the <em>alpha</em> parameters which are the intercepts of the hierarchical regression; mu, sigma and eps which are the hyperpriors of the regression.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="AnalysisBootstrap.html" class="btn btn-neutral float-right" title="Analysis Bootstrap" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="AnalysisFrequentistApproach.html" class="btn btn-neutral float-left" title="Analysis Frequentist Approach" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Playtika Ltd.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>